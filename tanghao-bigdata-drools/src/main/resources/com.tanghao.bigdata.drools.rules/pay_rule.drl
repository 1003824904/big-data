import com.tanghao.bigdata.drools.domain.request.MobilePaymentRequest;
import com.tanghao.bigdata.drools.domain.response.RuleResponse;
import com.tanghao.bigdata.drools.enums.EnumRuleResponseLevel;
import com.tanghao.bigdata.drools.service.PhoneNoBlacklistService;
import com.tanghao.bigdata.drools.service.MobilePaymentRuleService;

rule "pay_rule"
no-loop true
	when
        $pay : MobilePaymentRequest(RuleResponse.checkIsNull(response) && amount > 300);
    then
        $pay.setResponse("9999",EnumRuleResponseLevel.LOW.getCode(),"金额单笔金额超300了");
		update($pay);
end

rule "pay_rule2"
no-loop true
	when
        $pay : MobilePaymentRequest(RuleResponse.checkIsNull(response) && PhoneNoBlacklistService.isBlack(mobile));
    then
        $pay.setResponse("9999",EnumRuleResponseLevel.LOW.getCode(),"手机号在黑名单中");
		update($pay);
end

rule "pay_rule3"
no-loop true
	when
        $pay : MobilePaymentRequest(RuleResponse.checkIsNull(response) && amount > 3*MobilePaymentRuleService.getAvgAmountPerMonthByAccountNo(accountNo));
    then
        $pay.setResponse("9999",EnumRuleResponseLevel.MIDDLE.getCode(),"大于上月平均充值金额的3倍");
		update($pay);
end

rule "pay_rule4"
no-loop true
	when
        $pay : MobilePaymentRequest(RuleResponse.checkIsNull(response) && 10 >= MobilePaymentRuleService.getCountPerHourByAccountNo(accountNo));
    then
        $pay.setResponse("9999",EnumRuleResponseLevel.HIGH.getCode(),"1小时内最多充值10次！");
		update($pay);
end